<h3 class="text-gray-700 text-3xl font-medium">CLI Command Scraper</h3>
<p class="mt-4 text-gray-600">
    Gebruik deze tool om de meest recente FortiOS CLI-commando's direct van de Fortinet-documentatie te downloaden. De "CLI Command Finder" wordt hiermee automatisch bijgewerkt.
</p>

<div class="mt-8 bg-white p-6 rounded-lg shadow-md">
    <div id="scraper-controls">
        <p class="text-sm text-gray-800">Klik op de knop hieronder om het proces te starten. Dit kan enkele seconden duren.</p>
        <div class="mt-6">
            <button type="button" id="start-scraper-btn" class="w-full md:w-auto flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-[#da291c] hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                Start Scraper
            </button>
        </div>
    </div>

    <div id="scraper-log-wrapper" class="mt-4" style="display: none;">
         <div class="bg-gray-900 p-6 rounded-lg shadow-inner">
            <h4 class="text-lg font-semibold text-white">Scraper Log</h4>
            <div id="scraper-log-container" class="mt-4 bg-gray-800 text-white font-mono text-xs p-4 rounded-md h-64 overflow-y-auto whitespace-pre-wrap"></div>
        </div>
    </div>
</div>

<script>
(() => {
    const startBtn = document.getElementById('start-scraper-btn');
    const logWrapper = document.getElementById('scraper-log-wrapper');
    const logContainer = document.getElementById('scraper-log-container');

    startBtn.addEventListener('click', async () => {
        startBtn.disabled = true;
        startBtn.innerHTML = `<svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Scrapen...`;
        
        logWrapper.style.display = 'block';
        logContainer.innerHTML = 'Proces gestart...\n';

        try {
            const response = await fetch("{{ url_for('scraper.run_scraper') }}", { method: 'POST' });
            const result = await response.json();

            if (result.success) {
                const eventSource = new EventSource(`/scraper/progress/${result.session_id}`);
                
                eventSource.onmessage = (event) => {
                    logContainer.innerHTML += event.data + '\n';
                    logContainer.scrollTop = logContainer.scrollHeight;

                    if (event.data.includes("✅") || event.data.includes("❌")) {
                        eventSource.close();
                        startBtn.disabled = false;
                        startBtn.innerText = 'Start Scraper Opnieuw';
                    }
                };

                eventSource.onerror = () => {
                    logContainer.innerHTML += '❌ Fout bij het ontvangen van updates. Verbinding verbroken.\n';
                    eventSource.close();
                    startBtn.disabled = false;
                    startBtn.innerText = 'Probeer Opnieuw';
                };
            } else {
                throw new Error("Kon het scraper-proces niet starten.");
            }
        } catch (error) {
            logContainer.innerHTML += `❌ Kritieke fout: ${error.message}\n`;
            startBtn.disabled = false;
            startBtn.innerText = 'Probeer Opnieuw';
        }
    });
})();
</script>